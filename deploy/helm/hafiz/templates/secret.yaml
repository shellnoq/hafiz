{{/* Auth Secret (root credentials) */}}
{{- if not .Values.hafiz.auth.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "hafiz.fullname" . }}-auth
  labels:
    {{- include "hafiz.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.hafiz.auth.rootAccessKey }}
  access-key: {{ .Values.hafiz.auth.rootAccessKey | b64enc }}
  {{- else }}
  access-key: {{ randAlphaNum 20 | b64enc }}
  {{- end }}
  {{- if .Values.hafiz.auth.rootSecretKey }}
  secret-key: {{ .Values.hafiz.auth.rootSecretKey | b64enc }}
  {{- else }}
  secret-key: {{ randAlphaNum 40 | b64enc }}
  {{- end }}
{{- end }}
---
{{/* Encryption Secret */}}
{{- if and .Values.hafiz.encryption.enabled (not .Values.hafiz.encryption.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "hafiz.fullname" . }}-encryption
  labels:
    {{- include "hafiz.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.hafiz.encryption.masterKey }}
  encryption-key: {{ .Values.hafiz.encryption.masterKey | b64enc }}
  {{- else }}
  {{/* Generate a random 32-byte key and base64 encode it */}}
  encryption-key: {{ randAlphaNum 32 | b64enc | b64enc }}
  {{- end }}
{{- end }}
---
{{/* Admin Secret */}}
{{- if and .Values.hafiz.admin.enabled (not .Values.hafiz.admin.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "hafiz.fullname" . }}-admin
  labels:
    {{- include "hafiz.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.hafiz.admin.password }}
  admin-password: {{ .Values.hafiz.admin.password | b64enc }}
  {{- else }}
  admin-password: {{ randAlphaNum 24 | b64enc }}
  {{- end }}
{{- end }}
---
{{/* LDAP Secret */}}
{{- if and .Values.hafiz.ldap.enabled (not .Values.hafiz.ldap.existingSecret) .Values.hafiz.ldap.bindPassword }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "hafiz.fullname" . }}-ldap
  labels:
    {{- include "hafiz.labels" . | nindent 4 }}
type: Opaque
data:
  ldap-password: {{ .Values.hafiz.ldap.bindPassword | b64enc }}
{{- end }}
---
{{/* TLS Secret */}}
{{- if and .Values.hafiz.tls.enabled (not .Values.hafiz.tls.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "hafiz.fullname" . }}-tls
  labels:
    {{- include "hafiz.labels" . | nindent 4 }}
type: kubernetes.io/tls
data:
  tls.crt: {{ .Values.hafiz.tls.certificate | b64enc }}
  tls.key: {{ .Values.hafiz.tls.privateKey | b64enc }}
{{- end }}
---
{{/* External PostgreSQL Secret */}}
{{- if and (not .Values.postgresql.enabled) (not .Values.postgresql.external.existingSecret) .Values.postgresql.external.password }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "hafiz.fullname" . }}-postgresql-external
  labels:
    {{- include "hafiz.labels" . | nindent 4 }}
type: Opaque
data:
  postgresql-password: {{ .Values.postgresql.external.password | b64enc }}
{{- end }}
