# Hafiz Helm Chart Values
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- Number of Hafiz replicas
replicaCount: 3

image:
  # -- Container image repository
  repository: ghcr.io/yourorg/hafiz
  # -- Image pull policy
  pullPolicy: IfNotPresent
  # -- Overrides the image tag (default is chart appVersion)
  tag: ""

# -- Image pull secrets for private registries
imagePullSecrets: []

# -- Override the name of the chart
nameOverride: ""

# -- Override the full name of the chart
fullnameOverride: ""

# =============================================================================
# Hafiz Configuration
# =============================================================================

hafiz:
  # -- Log level (trace, debug, info, warn, error)
  logLevel: info
  
  # -- Log format (json, pretty)
  logFormat: json

  # S3 API Configuration
  s3:
    # -- S3 API port
    port: 9000
    # -- Region name
    region: us-east-1
    # -- Maximum request body size (e.g., "5GB")
    maxBodySize: "5GB"
    # -- Request timeout in seconds
    requestTimeout: 300

  # Admin API Configuration  
  admin:
    # -- Enable admin API
    enabled: true
    # -- Admin API port
    port: 9001
    # -- Admin username
    username: admin
    # -- Admin password (use existingSecret in production)
    password: ""
    # -- Use existing secret for admin credentials
    existingSecret: ""
    # -- Key in secret for admin password
    existingSecretKey: "admin-password"

  # Storage Configuration
  storage:
    # -- Storage backend type (filesystem, s3)
    type: filesystem
    # -- Base path for filesystem storage
    basePath: /data
    # -- Enable compression
    compression: true
    # -- Compression level (1-9)
    compressionLevel: 6

  # Metadata Configuration
  metadata:
    # -- Metadata backend type (sqlite, postgresql)
    type: postgresql
    # -- SQLite database path (if type: sqlite)
    sqlitePath: /data/metadata.db

  # Encryption Configuration
  encryption:
    # -- Enable server-side encryption
    enabled: true
    # -- Master key (32 bytes base64, use existingSecret in production)
    masterKey: ""
    # -- Use existing secret for master key
    existingSecret: ""
    # -- Key in secret for master key
    existingSecretKey: "encryption-key"

  # Authentication Configuration
  auth:
    # -- Root access key (use existingSecret in production)
    rootAccessKey: ""
    # -- Root secret key (use existingSecret in production)
    rootSecretKey: ""
    # -- Use existing secret for root credentials
    existingSecret: ""
    # -- Key in secret for access key
    accessKeySecretKey: "access-key"
    # -- Key in secret for secret key
    secretKeySecretKey: "secret-key"

  # Cluster Configuration
  cluster:
    # -- Enable cluster mode
    enabled: true
    # -- Cluster node ID (auto-generated if empty)
    nodeId: ""
    # -- Gossip port for cluster communication
    gossipPort: 7946
    # -- Sync port for data replication
    syncPort: 7947

  # LDAP Configuration
  ldap:
    # -- Enable LDAP authentication
    enabled: false
    # -- LDAP server URL
    url: "ldap://ldap.example.com:389"
    # -- Base DN for user search
    baseDn: "dc=example,dc=com"
    # -- Bind DN
    bindDn: "cn=admin,dc=example,dc=com"
    # -- Bind password (use existingSecret in production)
    bindPassword: ""
    # -- User search filter
    userFilter: "(uid={username})"
    # -- Group search filter
    groupFilter: "(member={dn})"
    # -- Use existing secret for LDAP bind password
    existingSecret: ""
    # -- Key in secret for bind password
    existingSecretKey: "ldap-password"

  # TLS Configuration
  tls:
    # -- Enable TLS
    enabled: false
    # -- TLS certificate (base64 encoded)
    certificate: ""
    # -- TLS private key (base64 encoded)
    privateKey: ""
    # -- Use existing secret for TLS
    existingSecret: ""
    # -- Key in secret for certificate
    certSecretKey: "tls.crt"
    # -- Key in secret for private key
    keySecretKey: "tls.key"

# =============================================================================
# Kubernetes Resources
# =============================================================================

serviceAccount:
  # -- Create a service account
  create: true
  # -- Annotations to add to the service account
  annotations: {}
  # -- The name of the service account (auto-generated if empty)
  name: ""

podAnnotations: {}

podLabels: {}

podSecurityContext:
  fsGroup: 1000
  runAsNonRoot: true

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000

# S3 API Service
service:
  # -- Service type
  type: ClusterIP
  # -- S3 API port
  port: 9000
  # -- Node port (if type is NodePort)
  nodePort: ""
  # -- Annotations for the service
  annotations: {}
  # -- Load balancer IP (if type is LoadBalancer)
  loadBalancerIP: ""
  # -- Load balancer source ranges
  loadBalancerSourceRanges: []

# Admin API Service
adminService:
  # -- Enable admin service
  enabled: true
  # -- Service type
  type: ClusterIP
  # -- Admin API port
  port: 9001
  # -- Node port (if type is NodePort)
  nodePort: ""
  # -- Annotations for the service
  annotations: {}

# Headless service for cluster discovery
headlessService:
  # -- Enable headless service
  enabled: true
  # -- Annotations for headless service
  annotations: {}

ingress:
  # -- Enable ingress
  enabled: false
  # -- Ingress class name
  className: "nginx"
  # -- Annotations for ingress
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
    # nginx.ingress.kubernetes.io/proxy-body-size: "5g"
  # -- Ingress hosts configuration
  hosts:
    - host: s3.example.com
      paths:
        - path: /
          pathType: Prefix
  # -- TLS configuration for ingress
  tls: []
  #  - secretName: hafiz-tls
  #    hosts:
  #      - s3.example.com

# Admin Ingress (separate from S3 API)
adminIngress:
  # -- Enable admin ingress
  enabled: false
  # -- Ingress class name
  className: "nginx"
  # -- Annotations for admin ingress
  annotations: {}
  # -- Admin ingress hosts
  hosts:
    - host: admin.s3.example.com
      paths:
        - path: /
          pathType: Prefix
  # -- TLS configuration for admin ingress
  tls: []

resources:
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 500m
    memory: 1Gi

# Horizontal Pod Autoscaler
autoscaling:
  # -- Enable HPA
  enabled: true
  # -- Minimum replicas
  minReplicas: 3
  # -- Maximum replicas
  maxReplicas: 10
  # -- Target CPU utilization percentage
  targetCPUUtilizationPercentage: 70
  # -- Target memory utilization percentage
  targetMemoryUtilizationPercentage: 80
  # -- Custom metrics for scaling
  customMetrics: []

# Pod Disruption Budget
podDisruptionBudget:
  # -- Enable PDB
  enabled: true
  # -- Minimum available pods
  minAvailable: 2
  # -- Maximum unavailable pods (alternative to minAvailable)
  maxUnavailable: ""

# Liveness probe configuration
livenessProbe:
  enabled: true
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

# Readiness probe configuration
readinessProbe:
  enabled: true
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3
  successThreshold: 1

# Startup probe configuration
startupProbe:
  enabled: true
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 30
  successThreshold: 1

# -- Node selector for pod scheduling
nodeSelector: {}

# -- Tolerations for pod scheduling
tolerations: []

# -- Affinity rules for pod scheduling
affinity: {}
  # podAntiAffinity:
  #   requiredDuringSchedulingIgnoredDuringExecution:
  #     - labelSelector:
  #         matchLabels:
  #           app.kubernetes.io/name: hafiz
  #       topologyKey: kubernetes.io/hostname

# -- Topology spread constraints
topologySpreadConstraints: []
  # - maxSkew: 1
  #   topologyKey: topology.kubernetes.io/zone
  #   whenUnsatisfiable: DoNotSchedule
  #   labelSelector:
  #     matchLabels:
  #       app.kubernetes.io/name: hafiz

# -- Priority class name
priorityClassName: ""

# -- Termination grace period in seconds
terminationGracePeriodSeconds: 30

# =============================================================================
# Persistence
# =============================================================================

persistence:
  # -- Enable persistence
  enabled: true
  # -- Storage class name (empty uses default)
  storageClassName: ""
  # -- Access modes
  accessModes:
    - ReadWriteOnce
  # -- Storage size
  size: 100Gi
  # -- Annotations for PVC
  annotations: {}
  # -- Selector for PVC
  selector: {}
  # -- Existing PVC name (if using existing PVC)
  existingClaim: ""

# =============================================================================
# Metrics & Monitoring
# =============================================================================

metrics:
  # -- Enable Prometheus metrics
  enabled: true
  # -- Metrics port
  port: 9090
  # -- Metrics path
  path: /metrics

  serviceMonitor:
    # -- Create ServiceMonitor resource
    enabled: false
    # -- Namespace for ServiceMonitor (defaults to release namespace)
    namespace: ""
    # -- Interval for scraping metrics
    interval: 30s
    # -- Timeout for scraping metrics
    scrapeTimeout: 10s
    # -- Additional labels for ServiceMonitor
    labels: {}
    # -- Relabelings for ServiceMonitor
    relabelings: []
    # -- Metric relabelings for ServiceMonitor
    metricRelabelings: []

  prometheusRule:
    # -- Create PrometheusRule resource
    enabled: false
    # -- Namespace for PrometheusRule
    namespace: ""
    # -- Additional labels for PrometheusRule
    labels: {}
    # -- Alerting rules
    rules: []
      # - alert: HafizHighErrorRate
      #   expr: rate(hafiz_http_requests_total{status=~"5.."}[5m]) > 0.1
      #   for: 5m
      #   labels:
      #     severity: warning
      #   annotations:
      #     summary: High error rate detected

# =============================================================================
# PostgreSQL (Bitnami subchart)
# =============================================================================

postgresql:
  # -- Enable PostgreSQL subchart
  enabled: true
  
  auth:
    # -- PostgreSQL username
    username: hafiz
    # -- PostgreSQL password
    password: ""
    # -- PostgreSQL database name
    database: hafiz
    # -- Use existing secret for PostgreSQL
    existingSecret: ""
  
  primary:
    persistence:
      # -- Enable persistence for PostgreSQL
      enabled: true
      # -- Storage size for PostgreSQL
      size: 20Gi
    
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 250m
        memory: 256Mi

  # For external PostgreSQL
  external:
    # -- External PostgreSQL host
    host: ""
    # -- External PostgreSQL port
    port: 5432
    # -- External PostgreSQL database
    database: hafiz
    # -- External PostgreSQL username
    username: hafiz
    # -- External PostgreSQL password
    password: ""
    # -- Use existing secret for external PostgreSQL
    existingSecret: ""
    # -- Key in secret for password
    existingSecretKey: "postgresql-password"

# =============================================================================
# Init Containers & Sidecars
# =============================================================================

# -- Extra init containers
extraInitContainers: []

# -- Extra sidecar containers
extraContainers: []

# -- Extra volumes
extraVolumes: []

# -- Extra volume mounts
extraVolumeMounts: []

# -- Extra environment variables
extraEnv: []

# -- Extra environment variables from secrets/configmaps
extraEnvFrom: []

# =============================================================================
# Network Policies
# =============================================================================

networkPolicy:
  # -- Enable network policy
  enabled: false
  # -- Ingress rules
  ingress: []
  # -- Egress rules
  egress: []
