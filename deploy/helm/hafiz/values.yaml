# Hafiz Helm Chart - Default Values
# This file contains default configuration values for the Hafiz S3-compatible storage.

# =============================================================================
# Global Settings
# =============================================================================

# Number of replicas (for standalone mode, use 1; for cluster mode, use 3+)
replicaCount: 1

# Image settings
image:
  repository: hafiz/hafiz
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion
  tag: ""

# Image pull secrets (for private registries)
imagePullSecrets: []

# Override chart name
nameOverride: ""
fullnameOverride: ""

# =============================================================================
# Service Account
# =============================================================================

serviceAccount:
  # Create a service account
  create: true
  # Annotations to add
  annotations: {}
  # Name (auto-generated if not set)
  name: ""

# =============================================================================
# Pod Settings
# =============================================================================

podAnnotations: {}

podSecurityContext:
  fsGroup: 1000

securityContext:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1000

# =============================================================================
# S3 API Service
# =============================================================================

service:
  type: ClusterIP
  port: 9000
  # nodePort: 30900  # Only if type is NodePort
  annotations: {}

# =============================================================================
# Admin Console Service
# =============================================================================

adminService:
  enabled: true
  type: ClusterIP
  port: 9001
  # nodePort: 30901  # Only if type is NodePort
  annotations: {}

# =============================================================================
# Ingress Configuration
# =============================================================================

ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: s3.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: hafiz-tls
  #    hosts:
  #      - s3.example.com

# Admin Ingress (separate)
adminIngress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: admin.s3.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []

# =============================================================================
# Resources
# =============================================================================

resources:
  # We recommend uncommenting these for production
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 500m
    memory: 1Gi

# =============================================================================
# Autoscaling (HPA)
# =============================================================================

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# =============================================================================
# Node Scheduling
# =============================================================================

nodeSelector: {}

tolerations: []

affinity: {}

# Pod topology spread constraints
topologySpreadConstraints: []

# =============================================================================
# Persistence
# =============================================================================

persistence:
  enabled: true
  
  # Storage class (leave empty for default)
  storageClass: ""
  
  # Access modes
  accessModes:
    - ReadWriteOnce
  
  # Size
  size: 100Gi
  
  # Existing PVC (leave empty to create new)
  existingClaim: ""
  
  # Annotations
  annotations: {}

# =============================================================================
# Hafiz Configuration
# =============================================================================

# Server settings
server:
  bindAddress: "0.0.0.0"
  port: 9000
  adminPort: 9001

# Authentication
auth:
  # Root credentials (will be stored in Secret)
  rootAccessKey: "minioadmin"
  rootSecretKey: "minioadmin"
  
  # Use existing secret (if set, auth.rootAccessKey/rootSecretKey are ignored)
  existingSecret: ""
  accessKeyKey: "access-key"
  secretKeyKey: "secret-key"

# Storage backend
storage:
  # Data directory (inside the container)
  dataDir: "/data/hafiz"
  
  # Encryption settings
  encryption:
    enabled: false
    masterKey: ""  # Auto-generated if empty and enabled
    existingSecret: ""
    masterKeyKey: "master-key"

# Database
database:
  # SQLite (embedded) or PostgreSQL
  type: sqlite  # sqlite or postgres
  
  # SQLite path (relative to dataDir)
  sqlitePath: "metadata.db"
  
  # PostgreSQL settings (if type is postgres)
  postgres:
    host: ""
    port: 5432
    database: "hafiz"
    username: "hafiz"
    password: ""
    sslMode: "disable"
    existingSecret: ""
    passwordKey: "password"

# =============================================================================
# TLS Configuration
# =============================================================================

tls:
  enabled: false
  
  # Use existing secret containing tls.crt and tls.key
  existingSecret: ""
  
  # Or provide certificates directly
  certificate: ""
  key: ""
  
  # mTLS (mutual TLS)
  mtls:
    enabled: false
    clientCA: ""

# =============================================================================
# Cluster Mode (Distributed)
# =============================================================================

cluster:
  enabled: false
  
  # Cluster mode requires 3+ replicas
  # Node discovery
  discovery:
    # Use Kubernetes headless service
    type: kubernetes
    
    # Or static list
    # type: static
    # nodes:
    #   - "hafiz-0.hafiz-headless:9100"
    #   - "hafiz-1.hafiz-headless:9100"
    #   - "hafiz-2.hafiz-headless:9100"
  
  # Internal cluster communication port
  port: 9100

# =============================================================================
# LDAP / Active Directory Integration
# =============================================================================

ldap:
  enabled: false
  
  serverUrl: ""  # ldaps://dc.example.com:636
  serverType: "active_directory"  # active_directory or openldap
  
  bindDn: ""
  bindPassword: ""
  existingSecret: ""
  bindPasswordKey: "ldap-password"
  
  userBaseDn: ""
  userFilter: "(sAMAccountName={username})"
  
  groupBaseDn: ""
  groupFilter: "(member={dn})"
  
  # Attribute mapping
  attributes:
    username: "sAMAccountName"
    email: "mail"
    displayName: "displayName"
  
  # Group to policy mapping (JSON)
  groupPolicies: |
    {
      "Domain Admins": ["admin"],
      "S3 Users": ["readwrite"]
    }
  
  # Cache settings
  cacheEnabled: true
  cacheTtl: 300

# =============================================================================
# Metrics & Monitoring
# =============================================================================

metrics:
  enabled: true
  port: 9000
  path: "/metrics"
  
  # ServiceMonitor for Prometheus Operator
  serviceMonitor:
    enabled: false
    namespace: ""
    interval: 30s
    scrapeTimeout: 10s
    labels: {}
    
  # Grafana dashboard ConfigMap
  grafanaDashboard:
    enabled: false
    labels:
      grafana_dashboard: "1"

# =============================================================================
# Logging
# =============================================================================

logging:
  level: "info"  # trace, debug, info, warn, error
  format: "json"  # json or pretty

# =============================================================================
# Health Checks
# =============================================================================

livenessProbe:
  enabled: true
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

readinessProbe:
  enabled: true
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3
  successThreshold: 1

startupProbe:
  enabled: false
  initialDelaySeconds: 0
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30
  successThreshold: 1

# =============================================================================
# Extra Configuration
# =============================================================================

# Extra environment variables
extraEnv: []
#  - name: EXTRA_VAR
#    value: "value"

# Extra volumes
extraVolumes: []

# Extra volume mounts
extraVolumeMounts: []

# Extra init containers
extraInitContainers: []

# Extra containers (sidecars)
extraContainers: []

# ConfigMap with additional configuration
extraConfigMap: ""

# Lifecycle hooks
lifecycle: {}
#  preStop:
#    exec:
#      command: ["/bin/sh", "-c", "sleep 10"]
